<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cadastro de Produto — Petshop</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Pequenas customizações */
    .input-card { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.06); }
    .tab-active { border-bottom: 2px solid #06b6d4; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <div class="max-w-6xl mx-auto">
    <header class="mb-6">
      <h1 class="text-2xl font-semibold">Cadastro de Produto</h1>
      <p class="text-sm text-gray-600">Página para inserir todas as informações dos produtos (ração, petiscos etc.).</p>
    </header>

    <form id="productForm" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Coluna esquerda (imagens, título, resumo) -->
      <div class="lg:col-span-2 space-y-4">
        <section class="p-4 input-card rounded-lg">
          <h2 class="font-medium mb-2">Imagens do Produto</h2>
          <p class="text-xs text-gray-500 mb-2">Arraste ou selecione imagens. Preview será exibido abaixo.</p>

          <label class="relative flex items-center gap-3 p-3 border-2 border-dashed border-gray-200 rounded cursor-pointer hover:border-gray-300">
            <input id="imageInput" type="file" accept="image/*" multiple class="sr-only" />
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7M16 3v4M8 3v4m-3 8l4-4 2 2 4-4 4 4"/></svg>
            <span class="text-sm">Clique para adicionar imagens (ou arraste). Máx 6 imagens recomendadas.</span>
          </label>

          <div id="imagePreview" class="mt-3 grid grid-cols-3 gap-3"></div>
        </section>

        <section class="p-4 input-card rounded-lg">
          <h2 class="font-medium mb-2">Título do Produto</h2>
          <input id="title" type="text" maxlength="100" placeholder="Ex: Ração Special Dog Premium - Frango e Arroz" class="w-full border p-2 rounded" />
          <p class="mt-1 text-xs text-gray-500">Máx. 100 caracteres. Restam: <span id="titleCount">100</span></p>
        </section>

        <section class="p-4 input-card rounded-lg">
          <h2 class="font-medium mb-2">Resumo Básico</h2>
          <textarea id="summary" maxlength="250" rows="3" placeholder="Resumo curto do produto (aparece nas listagens)" class="w-full border p-2 rounded"></textarea>
          <p class="mt-1 text-xs text-gray-500">Máx. 250 caracteres. Restam: <span id="summaryCount">250</span></p>
        </section>

        <!-- Abas com informações detalhadas -->
        <section class="p-4 input-card rounded-lg">
          <div class="flex gap-2 mb-4">
            <button type="button" class="tab-btn px-3 py-1 text-sm" data-tab="info">Informações</button>
            <button type="button" class="tab-btn px-3 py-1 text-sm" data-tab="dicas">Dicas</button>
            <button type="button" class="tab-btn px-3 py-1 text-sm" data-tab="especs">Especificações</button>
            <button type="button" class="tab-btn px-3 py-1 text-sm" data-tab="comparar">Comparar</button>
            <button type="button" class="tab-btn px-3 py-1 text-sm" data-tab="faq">Perguntas</button>
          </div>

          <div id="tabContents">
            <div id="info" class="tab-content">
              <label class="block text-sm font-medium mb-1">Descrição Completa</label>
              <textarea id="description" rows="6" class="w-full border p-2 rounded" placeholder="Descrição longa (texto rico não suportado nesta versão)."></textarea>
            </div>

            <div id="dicas" class="tab-content hidden">
              <label class="block text-sm font-medium mb-1">Dicas de uso e transição</label>
              <textarea id="tips" rows="4" class="w-full border p-2 rounded" placeholder="Dicas sobre administração, armazenamento, etc."></textarea>
            </div>

            <div id="especs" class="tab-content hidden">
              <label class="block text-sm font-medium mb-1">Especificações / Ingredientes</label>
              <textarea id="specs" rows="4" class="w-full border p-2 rounded" placeholder="Ingredientes, análise garantida, validade, conservantes, etc."></textarea>
            </div>

            <div id="comparar" class="tab-content hidden">
              <label class="block text-sm font-medium mb-1">Comparar com outros produtos</label>
              <p class="text-xs text-gray-500 mb-2">Selecione produtos para comparar (dados fictícios de exemplo nesta versão).</p>
              <select id="compareSelect" multiple class="w-full border p-2 rounded h-24">
                <!-- opções preenchidas via JS -->
              </select>
              <button type="button" id="compareBtn" class="mt-2 px-3 py-1 rounded bg-sky-500 text-white text-sm">Comparar</button>

              <div id="compareResult" class="mt-4 overflow-auto"></div>
            </div>

            <div id="faq" class="tab-content hidden">
              <label class="block text-sm font-medium mb-1">Perguntas e Respostas</label>
              <div id="faqList" class="space-y-2"></div>
              <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-2">
                <input id="faqQ" placeholder="Pergunta (ex: Aceita troca?)" class="border p-2 rounded col-span-2" />
                <input id="faqA" placeholder="Resposta" class="border p-2 rounded" />
                <button type="button" id="addFaq" class="col-span-3 mt-1 px-3 py-1 rounded bg-emerald-500 text-white">Adicionar pergunta</button>
              </div>
            </div>

          </div>
        </section>

      </div>

      <!-- Coluna direita (preços, tamanhos, desconto) -->
      <aside class="space-y-4">
        <section class="p-4 input-card rounded-lg">
          <h2 class="font-medium mb-2">Preços e Tamanhos</h2>

          <div class="mb-3">
            <label class="block text-sm font-medium">Preço base (para desconto)</label>
            <input id="basePrice" type="number" step="0.01" min="0" placeholder="Ex: 250.00" class="w-full border p-2 rounded" />
            <p class="text-xs text-gray-500 mt-1">Preço usado para calcular o desconto máximo de <strong>15%</strong>.</p>
            <p class="mt-2">Preço com 15% off: <strong id="priceWithDiscount">R$ 0,00</strong></p>
          </div>

          <div>
            <div class="flex justify-between items-center mb-2">
              <h3 class="font-medium">Tamanhos / Pacotes</h3>
              <button type="button" id="addSize" class="text-sm px-2 py-1 bg-indigo-500 text-white rounded">+ Adicionar tamanho</button>
            </div>

            <div id="sizesContainer" class="space-y-2"></div>

            <p class="mt-3 text-xs text-gray-500">Cada card mostra o preço por kg automaticamente.</p>
          </div>
        </section>

        <section class="p-4 input-card rounded-lg">
          <h2 class="font-medium mb-2">Metadados</h2>
          <label class="text-sm">Categoria</label>
          <select id="category" class="w-full border p-2 rounded mb-2">
            <option>Ração Cães</option>
            <option>Ração Gatos</option>
            <option>Petiscos</option>
            <option>Acessórios</option>
          </select>

          <label class="text-sm">Marca</label>
          <input id="brand" class="w-full border p-2 rounded mb-2" />

          <label class="text-sm">SKU</label>
          <input id="sku" class="w-full border p-2 rounded" />
        </section>

        <div class="flex gap-2">
          <button type="submit" class="flex-1 px-3 py-2 rounded bg-green-600 text-white">Salvar Produto</button>
          <button type="button" id="previewBtn" class="flex-1 px-3 py-2 rounded border">Visualizar</button>
        </div>
      </aside>
    </form>

    <footer class="mt-6 text-xs text-gray-500">Dica: Sempre preencha título, resumo, pelo menos um tamanho e imagens antes de salvar.</footer>
  </div>


  <script>
    /* --- Helpers --- */
    const $ = (id) => document.getElementById(id);

    // Title counter
    const title = $('title');
    const titleCount = $('titleCount');
    title?.addEventListener('input', (e) => titleCount.textContent = 100 - e.target.value.length);

    const summary = $('summary');
    const summaryCount = $('summaryCount');
    summary?.addEventListener('input', (e) => summaryCount.textContent = 250 - e.target.value.length);

    /* --- Image upload & preview --- */
    const imageInput = $('imageInput');
    const imagePreview = $('imagePreview');
    let images = []; // store File objects

    function renderPreviews(){
      imagePreview.innerHTML = '';
      images.forEach((file, idx) => {
        const url = URL.createObjectURL(file);
        const div = document.createElement('div');
        div.className = 'relative rounded overflow-hidden border';
        div.innerHTML = `
          <img src="${url}" class="w-full h-28 object-cover" />
          <button data-idx="${idx}" class="absolute top-1 right-1 bg-black/50 text-white rounded px-1 text-xs">Remover</button>
        `;
        imagePreview.appendChild(div);
      });
    }

    imageInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files).slice(0,6 - images.length); // limit to 6 total
      images = images.concat(files);
      renderPreviews();
    });

    imagePreview.addEventListener('click', (e) => {
      if(e.target.tagName === 'BUTTON'){
        const idx = Number(e.target.dataset.idx);
        images.splice(idx,1);
        renderPreviews();
      }
    });

    /* --- Price & Discount logic --- */
    const basePrice = $('basePrice');
    const priceWithDiscount = $('priceWithDiscount');

    function formatBRL(v){
      return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function updateDiscount(){
      const v = parseFloat(basePrice.value) || 0;
      const discounted = v * 0.85; // 15% off
      priceWithDiscount.textContent = formatBRL(discounted);
    }
    basePrice.addEventListener('input', updateDiscount);

    /* --- Sizes dynamic cards --- */
    const sizesContainer = $('sizesContainer');
    let sizes = []; // {id, weight, unit, price}
    let nextSizeId = 1;

    function createSizeCard(size){
      const id = size.id;
      const wrapper = document.createElement('div');
      wrapper.className = 'p-3 border rounded flex flex-col sm:flex-row gap-2 items-end';
      wrapper.dataset.id = id;

      wrapper.innerHTML = `
        <div class="flex-1 grid grid-cols-2 gap-2">
          <div>
            <label class="text-xs">Peso</label>
            <div class="flex gap-2">
              <input data-field="weight" type="number" step="0.01" min="0.001" value="${size.weight}" class="w-full border p-2 rounded" />
              <select data-field="unit" class="border p-2 rounded">
                <option ${size.unit==='kg'?'selected':''} value="kg">kg</option>
                <option ${size.unit==='g'?'selected':''} value="g">g</option>
              </select>
            </div>
          </div>

          <div>
            <label class="text-xs">Preço do pacote</label>
            <input data-field="price" type="number" step="0.01" min="0" value="${size.price}" class="w-full border p-2 rounded" />
          </div>
        </div>

        <div class="w-44 text-right">
          <p class="text-xs text-gray-500">Preço / kg</p>
          <p class="text-lg font-semibold mt-1" data-field="pricePerKg">R$ 0,00</p>
          <div class="flex gap-2 mt-3 justify-end">
            <button data-action="duplicate" class="px-2 py-1 text-sm border rounded">Duplicar</button>
            <button data-action="remove" class="px-2 py-1 text-sm bg-red-500 text-white rounded">Remover</button>
          </div>
        </div>
      `;

      // listeners
      wrapper.querySelectorAll('[data-field]').forEach(input => {
        input.addEventListener('input', () => {
          const weight = parseFloat(wrapper.querySelector('[data-field="weight"]').value) || 0;
          const unit = wrapper.querySelector('[data-field="unit"]').value;
          const price = parseFloat(wrapper.querySelector('[data-field="price"]').value) || 0;
          const weightKg = unit === 'g' ? weight/1000 : weight;
          const ppk = weightKg > 0 ? (price / weightKg) : 0;
          wrapper.querySelector('[data-field="pricePerKg"]').textContent = formatBRL(ppk);

          // update sizes array
          const idx = sizes.findIndex(s => s.id === id);
          if(idx > -1){ sizes[idx].weight = weight; sizes[idx].unit = unit; sizes[idx].price = price; }
        });
      });

      wrapper.querySelectorAll('[data-action]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const action = e.target.dataset.action;
          if(action === 'remove'){
            sizes = sizes.filter(s => s.id !== id);
            wrapper.remove();
          }
          if(action === 'duplicate'){
            const original = sizes.find(s => s.id === id);
            if(original){ addSize(original.weight, original.unit, original.price); }
          }
        });
      });

      sizesContainer.appendChild(wrapper);
      // trigger input event to calculate price/kg initially
      wrapper.querySelectorAll('[data-field]').forEach(el => el.dispatchEvent(new Event('input')));
    }

    function addSize(weight=10, unit='kg', price=0){
      const size = { id: nextSizeId++, weight, unit, price };
      sizes.push(size);
      createSizeCard(size);
    }

    $('addSize').addEventListener('click', () => addSize(10,'kg',0));

    // start with one default size
    addSize(15,'kg',250);

    /* --- Tabs --- */
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active','text-sky-600'));
        btn.classList.add('tab-active','text-sky-600');
        const tab = btn.dataset.tab;
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.getElementById(tab).classList.remove('hidden');
      });
    });
    // activate first tab
    document.querySelector('.tab-btn')?.click();

    /* --- Compare (fictício) --- */
    // Simular um catálogo com dados para comparar (no sistema real, preencher via API)
    const sampleProducts = [
      { id: 1, title: 'Ração A 15kg', brand: 'MarcaX', pricePerKg: 16.67, protein: '22%' },
      { id: 2, title: 'Ração B 10kg', brand: 'MarcaY', pricePerKg: 18.00, protein: '24%' },
      { id: 3, title: 'Ração C 15kg', brand: 'MarcaZ', pricePerKg: 15.55, protein: '26%' }
    ];

    const compareSelect = $('compareSelect');
    sampleProducts.forEach(p => {
      const opt = document.createElement('option'); opt.value = p.id; opt.textContent = `${p.title} — ${p.brand}`; compareSelect.appendChild(opt);
    });

    $('compareBtn').addEventListener('click', () => {
      const selected = Array.from(compareSelect.selectedOptions).map(o => Number(o.value));
      const items = sampleProducts.filter(p => selected.includes(p.id));
      if(items.length === 0){ $('compareResult').innerHTML = '<p class="text-sm text-gray-500">Selecione ao menos 1 produto para comparar.</p>'; return; }

      // montar tabela simples
      let html = '<table class="w-full text-sm border-collapse"><thead><tr class="bg-gray-100"><th class="p-2 border">Produto</th><th class="p-2 border">Marca</th><th class="p-2 border">Preço/kg</th><th class="p-2 border">Proteína</th></tr></thead><tbody>';
      items.forEach(it => {
        html += `<tr><td class="p-2 border">${it.title}</td><td class="p-2 border">${it.brand}</td><td class="p-2 border">${formatBRL(it.pricePerKg)}</td><td class="p-2 border">${it.protein}</td></tr>`;
      });
      html += '</tbody></table>';
      $('compareResult').innerHTML = html;
    });

    /* --- FAQ add --- */
    $('addFaq').addEventListener('click', () => {
      const q = $('faqQ').value.trim();
      const a = $('faqA').value.trim();
      if(!q || !a) return alert('Preencha pergunta e resposta.');
      const id = Date.now();
      const div = document.createElement('div');
      div.className = 'p-2 border rounded';
      div.innerHTML = `<div class="flex justify-between"><strong>${q}</strong><button data-id="${id}" class="text-xs text-red-600">Remover</button></div><p class="text-sm text-gray-700 mt-1">${a}</p>`;
      $('faqList').appendChild(div);
      $('faqQ').value = ''; $('faqA').value = '';
    });
    $('faqList').addEventListener('click', (e) => {
      if(e.target.tagName === 'BUTTON') e.target.closest('div').remove();
    });

    /* --- Form submit (demo) --- */
    $('productForm').addEventListener('submit', (e) => {
      e.preventDefault();
      // coletar dados
      const payload = {
        title: $('title').value.trim(),
        summary: $('summary').value.trim(),
        description: $('description').value.trim(),
        tips: $('tips').value.trim(),
        specs: $('specs').value.trim(),
        basePrice: parseFloat($('basePrice').value) || 0,
        sizes: sizes,
        imagesCount: images.length,
        category: $('category').value,
        brand: $('brand').value,
        sku: $('sku').value
      };
      console.log('Payload para envio:', payload);
      alert('Produto salvo (demo). Verifique console para ver o payload.' );
    });

    /* --- Preview button (simples) --- */
    $('previewBtn').addEventListener('click', () => {
      // gerar preview mínimo em nova janela
      const preview = window.open('', '_blank', 'noopener');
      const titleVal = $('title').value || 'Título do produto';
      const summaryVal = $('summary').value || '';
      const mainImage = images[0] ? URL.createObjectURL(images[0]) : '';
      const sizeHtml = sizes.map(s => {
        const w = s.unit === 'g' ? (s.weight/1000) + ' kg' : s.weight + ' kg';
        const ppk = (s.unit==='g' ? (s.price/(s.weight/1000)) : (s.price/s.weight)) || 0;
        return `<li>${w} — ${formatBRL(s.price)} (${formatBRL(ppk)}/kg)</li>`;
      }).join('');

      preview.document.write(`<h1>${titleVal}</h1><p>${summaryVal}</p>${ mainImage ? '<img src="'+mainImage+'" style="max-width:200px">' : '' }<ul>${sizeHtml}</ul>`);
      preview.document.close();
    });

  </script>
</body>
</html>
